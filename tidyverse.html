<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Introduction to the .fullprice[Multi]Tidyverse</title>
    <meta charset="utf-8" />
    <meta name="author" content="Marcell Granát" />
    <meta name="date" content="2022-01-01" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <link href="libs/tile-view/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view/tile-view.js"></script>
  </head>
  <body>
    <textarea id="source">
class: center, middle, title-slide

.title[
# Introduction to the .fullprice[Multi]Tidyverse
]
.subtitle[
## <img src="mnb_intezet.png" style="width:30.0%" />
Big Data and Data Visualisation
]
.author[
### Marcell Granát
]
.institute[
### Central Bank of Hungary &amp; .blue[John von Neumann University]
]
.date[
### 2022
]

---



background-image: url("tidyverse_files/tidyverse-intro.png")
background-position: center
background-size: contain

# The tidyverse

???

tidyverse.org

&lt;style type="text/css"&gt;
.red { color: red; }
.blue { color: #378C95; }
strong { color: red; }
a { color: #378C95; font-weight: bold; }
.remark-inline-code { font-weight: 900; background-color: #a7d5e7; }
.caption { color: #378C95; font-style: italic; text-align: center; }

.content-box { 
box-sizing: content-box;
background-color: #378C95;
/* Total width: 160px + (2 * 20px) + (2 * 8px) = 216px
Total height: 80px + (2 * 20px) + (2 * 8px) = 136px
Content box width: 160px
Content box height: 80px */
}

.content-box-green {
background-color: #d9edc2;
}

.content-box-red {
background-color: #f9dbdb;
}

.fullprice {
    text-decoration: line-through;
}
&lt;/style&gt;





---

# The tidyverse

`Tidyverse` contains the most important packages that you're likely to use in everyday data analyses:

-   [ggplot2](https://ggplot2.tidyverse.org/), for data visualisation.

-   [dplyr](https://dplyr.tidyverse.org/), for data manipulation.

-   [tidyr](https://tidyr.tidyverse.org/), for **tidy** data.

-   [readr](https://readr.tidyverse.org/), for data import.

--

-   [purrr](https://purrr.tidyverse.org/), for functional programming.

-   [tibble](https://tibble.tidyverse.org/), for tibbles (modernized data frames).

-   [stringr](https://github.com/tidyverse/stringr), for strings.

-   [forcats](https://github.com/tidyverse/forcats), for factors.

--

&gt; "The tidyverse also includes many other packages with more specialised usage. They are not loaded automatically with library(tidyverse), so you’ll need to load each one with its own call to library()."

---

# The tidyverse

Tidyverse works similarly to any other package, but when activated, **8 packages** are activated at the same time. The following message should appear then on the console:


```r
library(tidyverse)
```

```
## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──
```

```
## ✔ ggplot2 3.3.6     ✔ purrr   0.3.4
## ✔ tibble  3.1.7     ✔ dplyr   1.0.9
## ✔ tidyr   1.2.0     ✔ stringr 1.4.1
## ✔ readr   2.1.2     ✔ forcats 0.5.1
```

```
## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()
```
---

background-image: url("tidyverse_files/meme_pipe.gif")
background-position: center
background-size: cover
class: inverse

???

raw source for the gif: https://www.youtube.com/watch?v=aWzlQ2N6qqg

---

# The pipe

&gt; "The magrittr (to be pronounced with a sophisticated french accent) package has two aims: decrease development time and **improve readability** and maintainability of code. Or even shortr: make your code smokin’ (puff puff)! 

&gt; To achieve its humble aims, magrittr (remember the accent) provides a new “pipe”-like operator, **%&gt;%**, with which you may **pipe** a **value forward into an expression or function call**; something along the lines of **x %&gt;% f**, rather than **f(x)**. This is not an unknown feature elsewhere; a prime example is the .blue[|&gt;] operator used extensively in F# (to say the least) and indeed this – along with Unix pipes – served as a motivation for developing the magrittr package."

Source: [Package description](https://magrittr.tidyverse.org/articles/magrittr.html)

&lt;img src="tidyverse_files/pipe_meme2.jpg" width="200px" height="170px" style="display: block; margin: auto;" /&gt;

???

source of figure: https://www.facebook.com/statsystem/photos/pb.100029658941599.-2207520000../464780511996119/?type=3

---

# The pipe

- You can an insert a pipe operatior by `ctrl + shift + M` / `command + shift + M`

- To understand its relevance, you should think about it like telling **... then** to the program

&lt;p align="center"&gt;&lt;iframe width="560" height="315" src="https://www.youtube.com/embed/8SGif63VW6E?start=2249" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen&gt;&lt;/iframe&gt;&lt;/p&gt;

---

# The pipe - an example

Lets return to the `fertility_df` data frame.


```r
fertility_df &lt;- read_csv("https://stats.oecd.org/sdmx-json/data/DP_LIVE/.FERTILITY.../OECD?contentType=csv&amp;detail=code&amp;separator=comma&amp;csv-lang=en")
```


```r
fertility_df
```

```
## # A tibble: 3,239 × 8
##    LOCATION INDICATOR SUBJECT MEASURE   FREQUENCY  TIME Value `Flag Codes`
##    &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;       
##  1 AUS      FERTILITY TOT     CHD_WOMAN A          1960  3.45 NA          
##  2 AUS      FERTILITY TOT     CHD_WOMAN A          1961  3.55 NA          
##  3 AUS      FERTILITY TOT     CHD_WOMAN A          1962  3.43 NA          
##  4 AUS      FERTILITY TOT     CHD_WOMAN A          1963  3.34 NA          
##  5 AUS      FERTILITY TOT     CHD_WOMAN A          1964  3.15 NA          
##  6 AUS      FERTILITY TOT     CHD_WOMAN A          1965  2.97 NA          
##  7 AUS      FERTILITY TOT     CHD_WOMAN A          1966  2.89 NA          
##  8 AUS      FERTILITY TOT     CHD_WOMAN A          1967  2.85 NA          
##  9 AUS      FERTILITY TOT     CHD_WOMAN A          1968  2.89 NA          
## 10 AUS      FERTILITY TOT     CHD_WOMAN A          1969  2.89 NA          
## # … with 3,229 more rows
```

---

# The pipe - an example

Lets take an example with the following two functions from the {dplyr} package:

- `filter()` subset a data frame, retaining all rows that satisfy your conditions

- `count()` count the unique values of one or more variables

.blue[How many observations are there by years that are above 2.1?]

--

Step 1. Filter to rows where `Value &gt;= 2.1`


```r
filter(.data = fertility_df, Value &gt;= 2.1)
```

--

.content-box-green[
HINT: Unlike python or base R, in the case of dplyr functions, you can simply refer to the names of the variables without using "" or specifying the data frame.
]

---

# The pipe - an example


```r
filter(.data = fertility_df, Value &gt;= 2.1)
```

The following is identical with pipe. (The outcome before the `%&gt;%` is the first unspecified input of the next expression)


```r
fertility_df %&gt;% 
  filter(Value &gt;= 2.1)
```

```
## # A tibble: 1,374 × 8
##    LOCATION INDICATOR SUBJECT MEASURE   FREQUENCY  TIME Value `Flag Codes`
##    &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;       
##  1 AUS      FERTILITY TOT     CHD_WOMAN A          1960  3.45 NA          
##  2 AUS      FERTILITY TOT     CHD_WOMAN A          1961  3.55 NA          
##  3 AUS      FERTILITY TOT     CHD_WOMAN A          1962  3.43 NA          
##  4 AUS      FERTILITY TOT     CHD_WOMAN A          1963  3.34 NA          
##  5 AUS      FERTILITY TOT     CHD_WOMAN A          1964  3.15 NA          
##  6 AUS      FERTILITY TOT     CHD_WOMAN A          1965  2.97 NA          
##  7 AUS      FERTILITY TOT     CHD_WOMAN A          1966  2.89 NA          
##  8 AUS      FERTILITY TOT     CHD_WOMAN A          1967  2.85 NA          
##  9 AUS      FERTILITY TOT     CHD_WOMAN A          1968  2.89 NA          
## 10 AUS      FERTILITY TOT     CHD_WOMAN A          1969  2.89 NA          
## # … with 1,364 more rows
```

---

# The pipe - an example

Without the `%&gt;%` 2 possiblities exist to use the result of the `filter` in the `count` function

#### `#1 Assigning a new data frame


```r
fertility_df2 &lt;- filter(fertility_df, Value &gt;= 2.1)
count(fertility_df2, TIME)
```

#### `#2 Unreadable nesting


```r
count(filter(fertility_df, Value &gt;= 2.1), TIME)
```

```
## # A tibble: 61 × 2
##     TIME     n
##    &lt;dbl&gt; &lt;int&gt;
##  1  1960    47
##  2  1961    47
##  3  1962    47
##  4  1963    47
##  5  1964    47
##  6  1965    47
##  7  1966    45
##  8  1967    44
##  9  1968    44
## 10  1969    42
## # … with 51 more rows
```

---

# The pipe - an example

With the `%&gt;%`:


```r
fertility_df %&gt;% 
  filter(Value &gt;= 2.1) %&gt;% # "... and after the filtering ..."
  count(TIME)
```

```
## # A tibble: 61 × 2
##     TIME     n
##    &lt;dbl&gt; &lt;int&gt;
##  1  1960    47
##  2  1961    47
##  3  1962    47
##  4  1963    47
##  5  1964    47
##  6  1965    47
##  7  1966    45
##  8  1967    44
##  9  1968    44
## 10  1969    42
## # … with 51 more rows
```

--

**There is no additional unnecessary object in the env, and readable**

---

background-image: url("tidyverse_files/dplyr_logo.png")
background-position: center
background-size: contain

---

## HINT: [CHEATSHEETS](https://github.com/rstudio/cheatsheets)

&lt;img src="tidyverse_files/data-transformation - 01.jpg" width="6013" style="display: block; margin: auto;" /&gt;

---

## HINT: [CHEATSHEETS](https://github.com/rstudio/cheatsheets)

&lt;img src="tidyverse_files/data-transformation - 02.jpg" width="6013" style="display: block; margin: auto;" /&gt;







    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
