<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Introduction to R</title>
    <meta charset="utf-8" />
    <meta name="author" content="Marcell Gran√°t" />
    <meta name="date" content="2022-01-01" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <link href="libs/tile-view/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view/tile-view.js"></script>
  </head>
  <body>
    <textarea id="source">
class: center, middle, title-slide

.title[
# Introduction to R
]
.subtitle[
## <img src="mnb_intezet.png" style="width:30.0%" />
Big Data and Data Visualisation
]
.author[
### Marcell Gran√°t
]
.institute[
### Central Bank of Hungary &amp; .blue[John von Neumann University]
]
.date[
### 2022
]

---


class: inverse, center, middle

# ‚ÄúThe only way to write good code is to write tons of shitty code first. Feeling shame about bad code stops you from getting to good code‚Äù 

### Hadley Wickham

&lt;style type="text/css"&gt;
.red { color: red; }
.blue { color: #378C95; }
strong { color: red; }
a { color: #378C95; font-weight: bold; }
.remark-inline-code { font-weight: 900; background-color: #a7d5e7; }
.caption { color: #378C95; font-style: italic; text-align: center; }

.content-box { 
box-sizing: content-box;
background-color: #378C95;
/* Total width: 160px + (2 * 20px) + (2 * 8px) = 216px
Total height: 80px + (2 * 20px) + (2 * 8px) = 136px
Content box width: 160px
Content box height: 80px */
}

.content-box-green {
background-color: #d9edc2;
}

.content-box-red {
background-color: #f9dbdb;
}

&lt;/style&gt;







---
class: left

# Today's .blue[Agenda]

### Session 1 - Introduction to Statistics

1. Basic concepts of **statistical analysis** üê£

2. Descriptive statistics üìä

### Session 2 - Introduction to R

1. Why R? Setup üîå

2. Data types, basic manipulations üíæ

3. Conditional statements, loops ‚ôæÔ∏è

4. **Fun**ctions ü§ó , apply

---

# Why R?

.pull-left[
R is a **free** software, used by millions in the field of statistics, data science, economics and many others.

The R programming language is an important tool for data related tasks, but it is much more.
Just like other programming languages, R has many additional **packages** (18,584 in the CRAN), which can extend its basic functionality.
R has far the best **graphical tools** to create your charts, and with **shiny**, you can easily build your minimalist web applications, or dashboards.

.blue[We will learn about data manipulation, analysis and visualization methods.]

]

.pull-right[
&lt;img src="introduction-to-r_files/meme_free.jpg" width="977" /&gt;
]

---

## Why R? - Some examples

[A COVID tracker **written in R** (shiny, leaflet)](https://vac-lshtm.shinyapps.io/ncov_tracker/?_ga=2.146567862.383333130.1662737117-60780019.1662551588)


&lt;iframe src="https://vac-lshtm.shinyapps.io/ncov_tracker/?_ga=2.146567862.383333130.1662737117-60780019.1662551588" width="100%" height="400px" data-external="1"&gt;&lt;/iframe&gt;

???

source: https://shiny.rstudio.com/gallery/covid19-tracker.html

---

## Why R? - Some examples

[Real-time epidemiology of the Hungarian coronavirus epidemic (Tam√°s Ferenci)](https://research.physcon.uni-obuda.hu/COVID19MagyarEpi/)

&lt;iframe src="https://research.physcon.uni-obuda.hu/COVID19MagyarEpi/?showcase=0" width="100%" height="400px" data-external="1"&gt;&lt;/iframe&gt;

---

## Why R? - Some examples

.blue[Data import &amp; complex visualization in 10 minutes]

![](introduction-to-r_files/demograph-behind.gif)&lt;!-- --&gt;



---

# Setup

You can download R and RStudio from the official site of [RStudio](https://www.rstudio.com/products/rstudio/download/#download).
Please install the appropriate version based on your OS, and do not forget that you also have to install R as well.

&lt;img src="introduction-to-r_files/installr.png" width="2915" /&gt;


---

# What is RStudio?

RStudio is dedicated IDE (Integrated Development Environment) for R. It is not necessary to have RStudio on your PC in order to run **R code**, and you can also create codes on `notepad`. After all, it's just a **text file**.

.pull-left[
&lt;div class="figure"&gt;
&lt;img src="introduction-to-r_files/terminal.png" alt="Using R on the terminal" width="400px" height="200px" /&gt;
&lt;p class="caption"&gt;Using R on the terminal&lt;/p&gt;
&lt;/div&gt;
]

.pull-right[
&lt;img src="introduction-to-r_files/meme_helloworld.jpg" width="250px" /&gt;
]


If you like it better, you can use anything else instead (VScode for example), but I personally don't recommend it. RStudio is developed specially for R (and Python recently), therefore it will help us more than other IDEs (e.g. code snippets, code completions, rendering).

---

# At first glance

&lt;img src="introduction-to-r_files/rstudio-empty.png" width="4608" /&gt;

---

# At first glance

&lt;img src="introduction-to-r_files/rstudio-numbered.png" width="4608" /&gt;

---

# At first glance

## Source

We will write here our codes, which we would like to save. The default extension of our codes is`.R`, but this is not the only possibility (we will cover this later). Once you save your code for later use, you can open your script also with a simple text editor (like `Notepad`), since this is only plain text. If you hit `enter` your code won't be executed, you will just simply start a new line. If you want to run your code hit `ctrl + enter` to execute a single line, and `ctrl+shift+enter` to execute your full script.


---

# At first glance


.pull-left[
## Console

Here you find the executed codes and the response to them. For example, if you type `2 + 2` and hit `enter`, R will execute the expression, and respond that it is 4.


```r
2 + 2
```

```
## [1] 4
```
]

.pull-right[
&lt;img src="introduction-to-r_files/meme-brave.jpg" width="1104" height="400px" /&gt;

]


---

# At first glance

## Environment

Here you can see the list of the variables you have already created. For example you can type `x = 3` on the console. Now and x variable will appear in the environment pane, and you can check its value if you type `x` on the console. You can also save these variables into an `.RData` data format if you wish.

--

.content-box-green[
Hint: Go to preferences (General -&gt; Advanced) and enable the "Show **.Last.value** in environment listing" option. 
]

---

# At first glance

## Help

.pull-left[
You can use this pane if you are not familier with a function. For example, you want to know what input you can specify while using `mean`, you can type `?mean` on the console, or use the search field on this pane. The description of the function will be presented on this pane. (This pane is super useful on the exam)
]

.pull-right[
&lt;img src="introduction-to-r_files/meme-help.jpg" width="1000" /&gt;

]

---
# At first glance

##  Files

You can see the list of your files which are in the current working directory. Working directory is the folder, from where R reads the files currently. If you want to import a dataset, just click on a file on this pane.

I highly recommend you to set a project folder for the class and any later job. This means that, R creates a folder and puts an `.Rproj` file into it. You can always click on this  `.Rproj` file to return your unfinished work. You can customise if R should put the variables into your environment as you left them last time, you have a history about the used codes, and you see all the data you copy + paste into this folder.

---

# At first glance

## Packages

You can install packages from this pane. If you need a given package, click on install, and start typing its name. After that, you have to activate packages each time you open R again with the `library(eurostat)` command. You can also use a function from a package if you just simply type `eurostat::get_eurostat()`.


.content-box-green[
Hint: Never leave an install.packages(...) line in your code! This is the worst habit you can have in R programming, yet many people do it. If you think it's useful so that others can run it, it's not worth it either, since RStudio automatically detects packages that haven't been installed yet and recommends installing them.
]

---

class: middle, center, inverse

# Data types

---

## Data types

## Numeric

Lets see first, what kind of datatypes exist in R. Lets assign a variable called `x`.


```r
x &lt;- 4
```

So, what is the type of `x`? We can use the `class` command to answer this.


```r
class(x)
```

```
## [1] "numeric"
```

It's numeric. This means that you can use `+`, `-`, `*` operators on it. (Integer and double also exist in R, but these are not the default, and variables will be always coerced automatically.)

---

## Character


```r
y &lt;- "blue"
class(y)
```

```
## [1] "character"
```

It's a character, basically can contain any kind of letter, digits, or white space.

## Logical


```r
does_it_rain &lt;- TRUE
class(does_it_rain)
```

```
## [1] "logical"
```

It's a logical value. It can be `TRUE` or `FALSE`

---

# Vectors

We can create a vector with the `c` function. (combine)


```r
x &lt;- c(11, 201, 301)
x
```

```
## [1]  11 201 301
```

We can asses a given element of it by:


```r
x[2]
```

```
## [1] 201
```

Or you can use functions on it:

.pull-left[

```r
sum(x)
```

```
## [1] 513
```
]

.pull-right[

```r
x + 2
```

```
## [1]  13 203 303
```
]

---

## Creating vectors (sequences)

You can also easily create sequence with the syntax `start:stop`


```r
1:10
```

```
##  [1]  1  2  3  4  5  6  7  8  9 10
```

--

Or with the `seq` function


```r
seq(from = 2, to = 10, by = 2)
```

```
## [1]  2  4  6  8 10
```


```r
seq(from = 3, to = 53, length.out = 11)
```

```
##  [1]  3  8 13 18 23 28 33 38 43 48 53
```

.pull-left[

```r
x
```

```
## [1]  11 201 301
```
]

.pull-right[

```r
seq_along(x)
```

```
## [1] 1 2 3
```
]


---

# Factors

If you combine characters, you can convert this vector to factor type. This is useful if you want to sort the possible values into a given order, or specify which values should be accepted and which should be omitted.

Lets see a minimal example:


```r
my_vector &lt;- c("XL", "M", "L", "S", "L", "other")
sort(my_vector)
```

```
## [1] "L"     "L"     "M"     "other" "S"     "XL"
```


```r
my_vector2 &lt;- factor(my_vector, 
                     ordered = TRUE, 
                     levels = c("XS", "S", "M", "L", "XL")
)

sort(my_vector2)
```

```
## [1] S  M  L  L  XL
## Levels: XS &lt; S &lt; M &lt; L &lt; XL
```

---

# Data Frame

You can merge the vectors into a `data.frame`, which is simple a **table**. Each column is a *variable* (with a header), and each row is an *observation*.


```
##   id            name        species
## 1  1 Captain America          human
## 2  2            Hulk           &lt;NA&gt;
## 3  3           Groot Flora colossus
## 4  4         Strange          human
```

`NA` stands for "not applicable", so these values are missing. Most of the times you will work with data.frame, so it is the most important type.

---

# List

Storing more complex data, you can use the `list`. To use `data.frame` you need vectors with equal length. If this does not hold, or a more frequent case, you want to store a collection of data.frames, then `list` is a perfect solution! It is not a rare issue*, big panel dataset are usually stored in separated files (a different file to each year, like: `cis_survey2016.csv`, `cis_survey2017.csv`). In this situations I suggest to store your data in a list.


```r
mylist &lt;- list(avengers_df, my_vector, x)
```

Now `mylist` stores a data.frame and two vectors. You can access the elements by `[[ ]]`. For example, the 2nd element:


```r
mylist[[2]]
```

```
## [1] "XL"    "M"     "L"     "S"     "L"     "other"
```

.footnote[\*: *In the case of multiple models, we will also store them in a list, but more on that later*]

---

# Import data into R

The easiest way to import your data is to click on it in the files pane. This simple solution works if you have to import and analyse the data once, but probably you want to use your data next time as well. That is way it is a good idea to copy and paste the code for importing the data into your script (delete the `View()` command after that).

&lt;img src="introduction-to-r_files/importcsv.gif" height="400px" /&gt;

---

## Path to your files

If the data is in your working directory, you can refer to it with "**relative referencing**". This means that you have to type only the name of the file, not the full path, because R will automatically start to look for the file in the working directory.

--

.content-box-green[
That is the reason why you should always set a `project`* to your work.
]

.footnote[\* *A git <svg aria-hidden="true" role="img" viewBox="0 0 496 512" style="height:1em;width:0.97em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3 .3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5 .3-6.2 2.3zm44.2-1.7c-2.9 .7-4.9 2.6-4.6 4.9 .3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3 .7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3 .3 2.9 2.3 3.9 1.6 1 3.6 .7 4.3-.7 .7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3 .7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3 .7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> repo is more recommended, but it is not part of the current course.*]

--

.content-box-green[
HINT: You can type `""` anywhere in the source/console pane and hit `TAB` to completions to the files.
]

--

.content-box-green[
HINT: `list.files()` returns the name and path of the files in your current working directory.
]


#### Online data?

If the file you want to import was previously downloaded from a website, you can simply refer to the download **link** and **read it into R directly**. For this you have to only modify the path of the file to the download link what is available at the `download` folder in your browser.

---

# Conditional statements

We offen use conditional statement in programming. It has a clean concept: *If the condition is TRUE, then evaluate the following task.*


&lt;p align="center"&gt;&lt;iframe width="711" height="400" src="https://www.youtube.com/embed/m2Ux2PnJe6E" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen&gt;&lt;/iframe&gt;&lt;/p&gt;

---

# Snippets

.content-box-green[
If you want to write an if else statement in R, I highly recommend you to use a **snippet** for that. Snippet means, that when you type `if` and press `shift + tab`, then R will automatically write the framework you have to use:
]

![](introduction-to-r_files/snippet.gif)&lt;!-- --&gt;

---

# Logical Operators in R

.pull-left[


```r
4 &lt; 5
```

```
## [1] TRUE
```

```r
5 &lt;= 5
```

```
## [1] TRUE
```

```r
4 &gt; 5
```

```
## [1] FALSE
```
]

.pull-right[


```r
5 &gt;=4
```

```
## [1] TRUE
```

```r
2 == 3 # equal?
```

```
## [1] FALSE
```

```r
3 != 3 # not equal?
```

```
## [1] FALSE
```
]

&lt;img src="introduction-to-r_files/meme_false.png" width="300px" height="200px" style="display: block; margin: auto;" /&gt;


???

source: https://www.instagram.com/p/CiEXTeRodhj/

---

# Logical Operators in R

.pull-left[


```r
4 &lt; 5
```

```
## [1] TRUE
```

```r
5 &lt;= 5
```

```
## [1] TRUE
```

```r
4 &gt; 5
```

```
## [1] FALSE
```


```r
(2 + 2) == 4
```

```
## [1] TRUE
```

```r
is.na(4)
```

```
## [1] FALSE
```
]

.pull-right[


```r
5 &gt;=4
```

```
## [1] TRUE
```

```r
2 == 3 # equal?
```

```
## [1] FALSE
```

```r
3 != 3 # not equal?
```

```
## [1] FALSE
```


```r
is.na(NA)
```

```
## [1] TRUE
```

```r
3 %in% c(1, 2, 3)
```

```
## [1] TRUE
```
]

---

#### Division

.pull-left[

```r
13 %% 5 # remainder
```

```
## [1] 3
```
]

.pull-right[

```r
13 %/% 5
```

```
## [1] 2
```
]

#### Combining conditions

.pull-left[

```r
2 == 2 &amp; 2 == 3 # and
```

```
## [1] FALSE
```
]

.pull-right[

```r
2 == 2 | 2 == 3 # or
```

```
## [1] TRUE
```
]

#### Working with vectors


```r
x &lt;- 1:10
x %% 3 == 0
```

```
##  [1] FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE
```

```r
which(x %% 3 == 0)
```

```
## [1] 3 6 9
```

---


### IF


```r
if ((exam_p + assignment_p) &gt;= 90 &amp; assignment_p &gt;= 30) {
  grade &lt;- 5
} else if ((exam_p + assignment_p) &gt;= 80 &amp; assignment_p &gt;= 30) {
  grade &lt;- 4
} else if ((exam_p + assignment_p) &gt;= 66 &amp; assignment_p &gt;= 30) {
  grade &lt;- 3
} else if ((exam_p + assignment_p) &gt;= 50 &amp; assignment_p &gt;= 30) {
  grade &lt;- 2
} else { # if none are TRUE
  grade &lt;- 1
}
```

--

*Of course, there are simpler solutions to handle so many possible outputs, but this is just an illustrative example.*

---

class: center, middle, inverse

# Loops ‚ôæÔ∏è

---

# For loop

With this framework you can specify a task, that R has to do x times. For example, print a message 10 times.


```r
for (i in 1:10) {
  print("You R amazing!")
}
```

```
## [1] "You R amazing!"
## [1] "You R amazing!"
## [1] "You R amazing!"
## [1] "You R amazing!"
## [1] "You R amazing!"
## [1] "You R amazing!"
## [1] "You R amazing!"
## [1] "You R amazing!"
## [1] "You R amazing!"
## [1] "You R amazing!"
```

---

.pull-left[


And you can use `i` inside the `{` parenthesis.


```r
for (i in 1:5) {
  print(i)
}
```

```
## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5
```
]

--

.pull-right[
.content-box-green[
HINT: You have to learn how to use the for loop, because you will definitely face with it in other programming languages and in specific cases. However, we will see later that it is definitely worth avoiding their use in R, because **easier to read and faster codes can be written in other ways**. But it is worth using them, when you need to refer to the result of the **previous evaluation**.
]
]


&lt;img src="introduction-to-r_files/meme_fibonacci.png" width="358px" height="300px" style="display: block; margin: auto;" /&gt;

???

source of photo: https://www.reddit.com/r/memes/comments/conmyc/why_is_fibonacci/

---

### Fibonacci with for loop - first 10 elements

.pull-left[
&lt;img src="introduction-to-r_files/fibonacci.png" width="250px" height="200px" /&gt;
]

.pull-right[
`head(x, n)`: first n elements of x
`tail(x, n)`: last n elements of x
]


```r
fibonacci_seq &lt;- c(0, 1) # initial = 2 elements

for (i in 1:8) { # 8 + 2 = 10
  new_elem &lt;- sum(tail(fibonacci_seq, 2))
  
  fibonacci_seq &lt;- c(fibonacci_seq, new_elem)
}

fibonacci_seq
```

```
##  [1]  0  1  1  2  3  5  8 13 21 34
```

---

# While

You can also use `while` loop to specify a task R has to do until a condition is TRUE.


```r
x &lt;- 1

while (x &lt; 7) {
  cat(paste0(x, "^2=")) # cat = print, just into the same line
  cat(x^2)
  cat("\n") # force R to create a new line
  x &lt;- x + 1 # what happens if you miss this?
}
```

```
## 1^2=1
## 2^2=4
## 3^2=9
## 4^2=16
## 5^2=25
## 6^2=36
```

---

### Fibonacci with while loop - until reaches a limit (25)


```r
fibonacci_seq &lt;- c(0, 1) # initial = 2 elements
new_elem &lt;- tail(fibonacci_seq, 1)

while (new_elem &lt;  25) {
  new_elem &lt;- sum(tail(fibonacci_seq, 2))
  if (new_elem &lt; 25) { # do not add the one higher
    fibonacci_seq &lt;- c(fibonacci_seq, new_elem)
  }
}

fibonacci_seq
```

```
## [1]  0  1  1  2  3  5  8 13 21
```

---
class: center, middle, inverse

# Functions

#### "You should consider writing a function whenever you‚Äôve copied and pasted a block of code more than twice [...]"

Hadley Wickham


???

Source: https://r4ds.hadley.nz/functions.html

---

# Functions

We often work with functions in R, and you can also write your own. You have to use the `function` word and specify the input variables.

.content-box-green[
HINT: Use the FUN ü§ó snippet for that.
]


```r
fibonacci &lt;- function(n) {
  fibonacci_seq &lt;- c(0, 1) # initial = 2 elements
  
  for (i in 1:(max(n) - 2)) { # n can be a vector
    new_elem &lt;- sum(tail(fibonacci_seq, 2))
    
    fibonacci_seq &lt;- c(fibonacci_seq, new_elem)
  }
  
  fibonacci_seq[n]
}
```

.pull-left[

```r
fibonacci(1:5)
```

```
## [1] 0 1 1 2 3
```
]

.pull-right[

```r
fibonacci(5)
```

```
## [1] 3
```
]

---

## Funcions - default inputs


```r
fibonacci &lt;- function(n = 1:6) {
  fibonacci_seq &lt;- c(0, 1) # initial = 2 elements
  
  for (i in 1:(max(n) - 2)) { # n can be a vector
    new_elem &lt;- sum(tail(fibonacci_seq, 2))
    
    fibonacci_seq &lt;- c(fibonacci_seq, new_elem)
  }
  
  fibonacci_seq[n]
}
```

.pull-left[

```r
fibonacci()
```

```
## [1] 0 1 1 2 3 5
```
]

.pull-right[

```r
fibonacci(5)
```

```
## [1] 3
```
]

---

class: center, middle, inverse

# Apply, Lapply, Sapply

---

# Apply

The function `apply` calls a function on each row or column of a data.frame (or matrix). So its first argument is the `data.frame`, the third is the function which should use and the second is the margin:
- margin = 2: apply the given function on each of the COLUMNS
- margin = 1: apply the given function on each of the ROWS

---

## Example - Fertility rates by country / by year

.blue[Replacement Fertility Rate]: Assuming there are no migration flows and that mortality rates remain unchanged, a total fertility rate of 2.1 children per woman generates broad stability of population.

--


```r
above_replacement_prop &lt;- function(x) {
  # proportion of observation above the replacement rate
  # exclude NAs
  sum(x &gt;= 2.1, na.rm = TRUE) / sum(!is.na(x))
}
```

--


```r
x &lt;- c(1.3, 4, 2, NA)
above_replacement_prop(x)
```

```
## [1] 0.3333333
```

---

## Example - Fertility rates by country / by year

### Data from OECD


```r
fertility_df &lt;- read_csv("https://stats.oecd.org/sdmx-json/data/DP_LIVE/.FERTILITY.../OECD?contentType=csv&amp;detail=code&amp;separator=comma&amp;csv-lang=en")
fertility_df &lt;- fertility_df[, c("LOCATION", "TIME", "Value")]  

fertility_df
```


|LOCATION | TIME | Value |
|:--------|:----:|:-----:|
|AUS      | 1960 | 3.45  |
|AUS      | 1961 | 3.55  |
|AUS      | 1962 | 3.43  |
|AUS      | 1963 | 3.34  |
|AUS      | 1964 | 3.15  |
|...      | ...  |  ...  |

---

# Data manipulation

(This step is necessary, later we will understand what is actually happening here.)


```r
fertility_df &lt;- tidyr::pivot_wider(fertility_df, names_from = "LOCATION", 
                   values_from = "Value")

fertility_df &lt;- tibble::column_to_rownames(fertility_df, "TIME")
fertility_df &lt;- fertility_df[, - 51] # OECD average

fertility_df
```


|     |AUS  | AUT  | BEL  | CAN  | ... |
|:----|:----|:----:|:----:|:----:|:---:|
|1960 |3.45 | 2.69 | 2.54 | 3.9  | ... |
|1961 |3.55 | 2.78 | 2.63 | 3.84 | ... |
|1962 |3.43 | 2.8  | 2.59 | 3.76 | ... |
|1963 |...  | ...  | ...  | ...  | ... |

At the end of these steps, we have a table, each column of which shows the time series of the fertility rate of a country.

---

### Apply - MARGIN = 1


```r
apply(fertility_df, MARGIN = 1, above_replacement_prop)
```

```
##      1960      1961      1962      1963      1964      1965      1966      1967 
## 0.9200000 0.9200000 0.9200000 0.9200000 0.9200000 0.9200000 0.8800000 0.8600000 
##      1968      1969      1970      1971      1972      1973      1974      1975 
## 0.8600000 0.8200000 0.8000000 0.7800000 0.6800000 0.6600000 0.6600000 0.6274510 
##      1976      1977      1978      1979      1980      1981      1982      1983 
## 0.6078431 0.5686275 0.5098039 0.5294118 0.4807692 0.4230769 0.3962264 0.4339623 
##      1984      1985      1986      1987      1988      1989      1990      1991 
## 0.3962264 0.3773585 0.4339623 0.4339623 0.4716981 0.3773585 0.3584906 0.3396226 
##      1992      1993      1994      1995      1996      1997      1998      1999 
## 0.3018868 0.2830189 0.2830189 0.2452830 0.2641509 0.2452830 0.2452830 0.2452830 
##      2000      2001      2002      2003      2004      2005      2006      2007 
## 0.2264151 0.2264151 0.2264151 0.2075472 0.1886792 0.1886792 0.2075472 0.2264151 
##      2008      2009      2010      2011      2012      2013      2014      2015 
## 0.2075472 0.2075472 0.1886792 0.1509434 0.1886792 0.1698113 0.1698113 0.1698113 
##      2016      2017      2018      2019      2020      2021 
## 0.1698113 0.1509434 0.1509434 0.1538462 0.1346154 0.0000000
```

If MARGIN == 1, the apply calculates the proportion of observation above 2.1 in each **row**. The returned value is a named vector, which means that you can refer to its values by index, or by name.

---

### Apply - MARGIN = 1


```r
apply(fertility_df, MARGIN = 1, above_replacement_prop)[1]
```

```
## 1960 
## 0.92
```

```r
apply(fertility_df, MARGIN = 1, above_replacement_prop)["2020"]
```

```
##      2020 
## 0.1346154
```

---

### Apply - MARGIN = 2


```r
apply(fertility_df, MARGIN = 2, above_replacement_prop)
```

```
##        AUS        AUT        BEL        CAN        CZE        DNK        FIN 
## 0.26229508 0.19672131 0.19672131 0.19672131 0.22950820 0.14754098 0.14754098 
##        FRA        DEU        GRC        HUN        ISL        IRL        ITA 
## 0.24193548 0.16393443 0.36065574 0.06557377 0.57377049 0.49180328 0.27868852 
##        JPN        KOR        LUX        MEX        NLD        NZL        NOR 
## 0.13114754 0.37096774 0.14754098 0.98360656 0.21311475 0.44262295 0.24590164 
##        POL        PRT        SVK        ESP        SWE        CHE        TUR 
## 0.47540984 0.36065574 0.47540984 0.34426230 0.16129032 0.17741935 0.88524590 
##        GBR        USA        BRA        CHL        CHN        EST        IND 
## 0.21311475 0.22950820 0.72131148 0.65573770 0.52459016 0.18032787 1.00000000 
##        IDN        ISR        RUS        SVN        ZAF        COL        LVA 
## 1.00000000 1.00000000 0.18032787 0.34426230 1.00000000 0.78688525 0.08196721 
##        LTU        ARG        BGR        HRV        CYP        MLT        ROU 
## 0.34426230 1.00000000 0.26229508 0.11475410 0.33333333 0.09756098 0.30434783 
##        SAU        PER        CRI         EU 
## 1.00000000 1.00000000 0.72131148 0.28813559
```

If MARGIN == 2, the apply calculates the proportion of observation above 2.1 in each **column**.

---

# Lapply

`lapply` should be used for same purposes, but it can be used for lists or vectors. 


```r
mylist
```

```
## [[1]]
##   id            name        species
## 1  1 Captain America          human
## 2  2            Hulk           &lt;NA&gt;
## 3  3           Groot Flora colossus
## 4  4         Strange          human
## 
## [[2]]
## [1] "XL"    "M"     "L"     "S"     "L"     "other"
## 
## [[3]]
## [1]  11 201 301
```

---

# Lapply

`lapply` should be used for the same purposes, but it can be used for lists or vectors. 

Length of each element:


```r
lapply(mylist, length)
```

```
## [[1]]
## [1] 3
## 
## [[2]]
## [1] 6
## 
## [[3]]
## [1] 3
```

---

# Sapply

`sapply` is fully identical but returns a vector (*s* stand for SIMPLIFY)


```r
sapply(mylist, length)
```

```
## [1] 3 6 3
```

---

class: center, middle

# Thank you for your attention!

Slides are available at [https://www.marcellgranat.com](https://www.marcellgranat.com)

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
